<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACİL ASİSTAN PRO | Dinamik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .active-tab { color: #ef4444; border-top: 4px solid #ef4444; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        body { background-color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .loader { border-top-color: #ef4444; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-24">

    <div id="loading-overlay" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="loader w-12 h-12 border-4 border-gray-200 rounded-full mb-4"></div>
        <p class="text-gray-500 font-bold animate-pulse">Veriler Güncelleniyor...</p>
    </div>

    <header class="glass sticky top-0 z-50 border-b border-gray-100 p-4">
        <div class="flex justify-between items-center max-w-lg mx-auto">
            <div>
                <h1 class="font-black text-2xl text-gray-800 tracking-tight">ACİL<span class="text-red-600">ASİSTAN</span></h1>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Canlı Veri Bağlantısı Aktif</p>
            </div>
            <div id="status-dot" class="h-3 w-3 bg-green-500 rounded-full"></div>
        </div>
    </header>

    <main class="max-w-lg mx-auto p-4 space-y-6">
        
        <section id="modul-doz" class="space-y-4">
            <div class="bg-white rounded-3xl shadow-xl shadow-gray-200/50 p-6 border border-gray-50">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-red-100 p-3 rounded-2xl"><i class="fa-solid fa-calculator text-red-600"></i></div>
                    <h2 class="font-bold text-xl text-gray-800">Doz Hesaplayıcı</h2>
                </div>
                
                <div class="space-y-5">
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase ml-1">Hasta Kilosu</label>
                        <div class="relative mt-1">
                            <input type="number" id="kiloInput" placeholder="0" class="w-full bg-gray-50 border-none rounded-2xl p-5 text-3xl font-black text-gray-800 focus:ring-4 focus:ring-red-100 outline-none transition-all">
                            <span class="absolute right-5 top-1/2 -translate-y-1/2 text-gray-300 font-bold text-xl">kg</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase ml-1">Tablodan Çekilen İlaçlar</label>
                        <select id="ilacSelect" class="w-full mt-1 bg-gray-50 border-none rounded-2xl p-5 text-lg font-bold text-gray-700 outline-none appearance-none">
                            </select>
                    </div>

                    <button onclick="hesapla()" class="w-full bg-gray-900 text-white font-black py-5 rounded-2xl shadow-lg active:scale-95 transition-all text-lg tracking-wide">HESAPLA</button>

                    <div id="sonucPanel" class="hidden bg-red-600 rounded-2xl p-6 text-center text-white shadow-xl">
                        <p class="text-xs font-bold opacity-80 uppercase tracking-widest">Uygulanacak Doz</p>
                        <h3 id="sonucDeger" class="text-5xl font-black my-1">--</h3>
                        <p id="sonucMetin" class="text-sm font-medium opacity-90"></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="modul-algo" class="hidden">
            <div class="bg-white rounded-3xl shadow-xl p-6 text-center">
                <i class="fa-solid fa-diagram-project text-4xl text-blue-500 mb-4"></i>
                <h3 class="text-xl font-bold">Algoritmalar</h3>
                <p class="text-gray-500 mt-2">Bu bölüm bir sonraki aşamada tablonun 2. sekmesine bağlanacak.</p>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-gray-100 flex justify-around items-center p-3 z-50">
        <button onclick="tabDegistir('doz')" id="nav-doz" class="flex flex-col items-center gap-1 p-2 active-tab">
            <i class="fa-solid fa-vial-circle-check text-xl"></i>
            <span class="text-[10px] font-black uppercase">Doz</span>
        </button>
        <button onclick="tabDegistir('algo')" id="nav-algo" class="flex flex-col items-center gap-1 p-2 text-gray-400">
            <i class="fa-solid fa-heart-pulse text-xl"></i>
            <span class="text-[10px] font-black uppercase">Algoritma</span>
        </button>
        <button onclick="sesliDinle()" class="relative -top-8 bg-red-600 text-white h-16 w-16 rounded-full shadow-2xl flex items-center justify-center border-4 border-white active:scale-90 transition-all">
            <i class="fa-solid fa-microphone text-2xl"></i>
        </button>
        <div class="w-12"></div><div class="w-12"></div>
    </nav>

    <script>
        const TABLO_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQxXvPBsPF_TiInlZaVjrSo1DcHLaq4TyyMEnXybkfqgdUBRofs2h4fqVSKDRHkKeG6JBgLdbEA55bM/pub?gid=189673092&single=true&output=csv';
        let ilacVerileri = [];

        // 1. Verileri Tablodan Çek
        async function verileriGetir() {
            try {
                const response = await fetch(TABLO_URL);
                const data = await response.text();
                const satirlar = data.split('\n').slice(1); // Başlığı atla

                const select = document.getElementById('ilacSelect');
                select.innerHTML = '';

                satirlar.forEach(satir => {
                    const hucreler = satir.split(',');
                    if(hucreler.length >= 2) {
                        const ad = hucreler[0].trim();
                        const doz = hucreler[1].trim();
                        const birim = hucreler[2] ? hucreler[2].trim() : 'mg';
                        
                        ilacVerileri.push({ ad, doz, birim });
                        
                        let opt = document.createElement('option');
                        opt.value = doz;
                        opt.innerHTML = `${ad} (${doz} ${birim})`;
                        select.appendChild(opt);
                    }
                });
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').remove(), 500);
            } catch (error) {
                console.error("Veri çekilemedi:", error);
                alert("Veri bağlantısı kurulamadı. Lütfen interneti kontrol edin.");
            }
        }

        function hesapla() {
            const kilo = document.getElementById('kiloInput').value;
            const select = document.getElementById('ilacSelect');
            const doz = select.value;
            const secilenIlac = select.options[select.selectedIndex].text;

            if(!kilo) { alert("Kilo girmediniz!"); return; }

            const sonuc = (kilo * parseFloat(doz)).toFixed(2);
            const birim = ilacVerileri[select.selectedIndex].birim;

            document.getElementById('sonucDeger').innerText = `${sonuc} ${birim}`;
            document.getElementById('sonucMetin').innerText = `${secilenIlac} hazırlanıyor...`;
            document.getElementById('sonucPanel').classList.remove('hidden');

            const msg = new SpeechSynthesisUtterance("Hesaplanan doz: " + sonuc + " " + birim);
            msg.lang = 'tr-TR';
            window.speechSynthesis.speak(msg);
        }

        function tabDegistir(hedef) {
            document.getElementById('modul-doz').classList.toggle('hidden', hedef !== 'doz');
            document.getElementById('modul-algo').classList.toggle('hidden', hedef !== 'algo');
            document.getElementById('nav-doz').classList.toggle('active-tab', hedef === 'doz');
            document.getElementById('nav-algo').classList.toggle('active-tab', hedef === 'algo');
        }

        function sesliDinle() {
            const msg = new SpeechSynthesisUtterance("Dinleme modülü aktif değil. Kodlama devam ediyor.");
            msg.lang = 'tr-TR';
            window.speechSynthesis.speak(msg);
        }

        // Sayfa açıldığında verileri çek
        window.onload = verileriGetir;
    </script>
</body>
</html>
